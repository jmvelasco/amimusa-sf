{% extends 'base.html.twig' %}

{% block header %}
{% endblock %}

{% block body %}
    <div id="container">
        <div id="formWrapper">
        {{ form_start(form) }}
        <div class="row">
            <div class="col-xs-4">
                <div class="form-group">
                    {{ form_label(form.title) }}
                    {{ form_errors(form.title) }}
                    {{ form_widget(form.title, { 'attr': {'class': 'form-control'} }) }}
                </div>
                <div class="form-group">
                    {{ form_label(form.musas) }}
                    {{ form_widget(form.musas, { 'attr': {'class': 'form-control musas', 'rows': 1, 'style' : 'resize: none'} }) }}
                    <p class="form-message">Pulsa ENTER despu√©s de indicar tu musa o selecciona alguna de las existentes:</p>
                </div>
                <div id="musas"></div>

            </div>

            <div class="col-xs-8">
                <div class="form-group">
                    {{ form_label(form.body) }}
                    {{ form_errors(form.body) }}
                    {{ form_widget(form.body, { 'attr': {'class': 'form-control body-writting', 'rows': 16} }) }}
                </div>
                <div id="musas-list"><div id="error-message">{{ form_errors(form.musas) }}</div></div>
                {{ form_widget(form.musasid_list, { 'attr': {'id': 'musasid_list'} }) }}
            </div>
            {{ form_widget(form.musasid_list, { 'attr': {'id': 'publicationid'} }) }}

            <div class="pull-right" style="margin-top: 40px;">
            {{ form_widget(form.save, { 'attr': {'class': 'btn btn-primary'} }) }}
            <a class="btn btn-default" href="{{ path('show-musas', {'idMusa': app.request.get('idMusa')}) }}">Volver</a>
            </div>

        </div>

        {{ form_end(form) }}
        </div>

    </div>
{% endblock %}

{% block javascripts %}
    <!-- jQuery library (served from Google) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="/assets/common.js"></script>
    <script src="/assets/publication-handler.js"></script>

    <script type="application/javascript">
        $(document).ready(function() {
            // Crear un array con todas las musas disponibles en el sistema
            var musas = [];
            {% for m in musas %}
            var obj = {
                'name': '{{ m.name|replace({"\n":""}) }}',
                'id': {{ m.id }}
            }
            musas.push(obj);
            {% endfor %}

            var musasId = $("#form_musasid_list").val().split(",");
            for (var i = 0; i < musas.length; i++) {
                $("#musas").createMusa({id: musas[i].id, name: musas[i].name});
                if (-1 != $.inArray(musas[i].id.toString(), musasId)) {
                    $("#musas-list").renderMusa({id:musas[i].id, name: musas[i].name});
                }
            }
        });

    </script>
{% endblock %}
{% block stylesheets %}
    <!-- Bootstrap -->
    <link href="/assets/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/publication.css" rel="stylesheet">
{% endblock %}
